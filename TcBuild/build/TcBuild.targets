<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <TcBuildPath Condition="$(TcBuildPath) == ''">$(MSBuildThisFileDirectory)..\</TcBuildPath>
    <TcBuildAssemblyDirectory>$(TcBuildPath)bin\netstandard2.0</TcBuildAssemblyDirectory>
    <TcPluginBase>$(TcBuildPath)lib\net5.0-windows\TcPluginBase.dll</TcPluginBase>
    <TcBuildAssembly Condition="$(TcBuildAssembly) == ''">$(TcBuildAssemblyDirectory)\TcBuild.dll</TcBuildAssembly>
  </PropertyGroup>

  <UsingTask
    TaskName="TcBuild.TcBuildTask"
    AssemblyFile="$(TcBuildAssembly)" />

  <!--<UsingTask TaskName="TcBuild.TcBuildTask" AssemblyFile="$(TcBuildAssembly)" />-->

  <!-- look https://github.com/3F/DllExport/blob/master/tools/net.r_eg.DllExport.targets -->
  <Target
    Name="TcBuildTarget"
    AfterTargets="Build"
    Condition="Exists(@(IntermediateAssembly)) And $(DesignTimeBuild) != true"
    DependsOnTargets="$(TcBuildDependsOnTargets)">

    <PropertyGroup>
      <TcBuild_DnneNativeOutputFile>$(DnneNativeExportsBinaryPath)$(DnneNativeExportsBinaryName)$(DnneNativeBinaryExt)</TcBuild_DnneNativeOutputFile>
      <TcBuild_DnneNativeSourceFiles>$(DnneNativeExportsBinaryPath)$(DnneNativeExportsBinaryName).h;$(DnneNativeExportsBinaryPath)dnne.h</TcBuild_DnneNativeSourceFiles>

      <TcBuild_GeneratedFiles></TcBuild_GeneratedFiles>
    </PropertyGroup>

    <Delete Files="$(TcBuild_DnneNativeSourceFiles)" />

    <TcBuild.TcBuildTask
      AssemblyFile="$(TargetPath)"
      NativeAssemblyFile="$(TcBuild_DnneNativeOutputFile)"
      IntermediateDirectory="$(TargetDir)"
      ReferenceCopyLocalFiles="@(ReferenceCopyLocalPaths)">

      <Output TaskParameter="GeneratedFiles" PropertyName="TcBuild_GeneratedFiles" />

    </TcBuild.TcBuildTask>

  </Target>

  <PropertyGroup>
    <CleanDependsOn>TcBuildClean;$(CleanDependsOn);</CleanDependsOn>
  </PropertyGroup>
  <Target Name="TcBuildClean">
    <Delete Files="$(TcBuild_GeneratedFiles)" />
  </Target>

</Project>